(this["webpackJsonpdnd-online-board"]=this["webpackJsonpdnd-online-board"]||[]).push([[0],{119:function(e,t,a){e.exports=a(299)},124:function(e,t,a){},125:function(e,t,a){},128:function(e,t,a){},129:function(e,t,a){},130:function(e,t,a){},29:function(e,t,a){},299:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(109),o=a.n(l),s=(a(124),a(22)),c=a(8),i=a(1),m=a(2),u=a(4),h=a(3),d=(a(125),a(10),a(35),function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).state={diceType:4,diceCount:1,resultSum:void 0},e.handleRoll=function(){for(var t=e.state,a=t.diceCount,n=t.diceType,r=0,l=0;l<a;l++)r+=Math.floor(Math.random()*n)+1;e.setState({resultSum:r})},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.diceCount,n=t.resultSum;return r.a.createElement("ul",{className:"nav nav-tabs flex-column bg-dark row w-100 MenuUl ml-1"},r.a.createElement("h4",{className:"mb-4"},r.a.createElement("span",{className:"creatorHeader"},"Roll Dice")),r.a.createElement("li",{className:"nav-item"},r.a.createElement("label",{className:"mr-3 mb-2 radio control-label"},"Dice type:"),r.a.createElement("span",null,r.a.createElement("label",{className:"ml-1 mr-2 radio control-label",htmlFor:"d-4"},r.a.createElement("input",{className:"radio m-1",type:"radio",name:"DieType",value:4,id:"d-4",defaultChecked:!0,onChange:function(t){return e.setState({diceType:t.target.value})}}),"D-4"),r.a.createElement("label",{className:"ml-1 mr-2 radio control-label",htmlFor:"d-6"},r.a.createElement("input",{className:"radio m-1",type:"radio",name:"DieType",value:6,id:"d-6",onChange:function(t){return e.setState({diceType:t.target.value})}}),"D-6"),r.a.createElement("label",{className:"ml-1 mr-2 radio control-label",htmlFor:"d-8"},r.a.createElement("input",{className:"radio m-1",type:"radio",name:"DieType",value:8,id:"d-8",onChange:function(t){return e.setState({diceType:t.target.value})}}),"D-8"),r.a.createElement("label",{className:"ml-1 mr-2 radio control-label",htmlFor:"d-10"},r.a.createElement("input",{className:"radio m-1",type:"radio",name:"DieType",value:10,id:"d-10",onChange:function(t){return e.setState({diceType:t.target.value})}}),"D-10"),r.a.createElement("label",{className:"ml-1 mr-2 radio control-label",htmlFor:"d-12"},r.a.createElement("input",{className:"radio m-1",type:"radio",name:"DieType",value:12,id:"d-12",onChange:function(t){return e.setState({diceType:t.target.value})}}),"D-12"),r.a.createElement("label",{className:"ml-1 mr-2 radio control-label",htmlFor:"d-20"},r.a.createElement("input",{className:"radio m-1",type:"radio",name:"DieType",value:20,id:"d-20",onChange:function(t){return e.setState({diceType:t.target.value})}}),"D-20"),r.a.createElement("label",{className:"ml-1 mr-2 radio control-label",htmlFor:"d-100"},r.a.createElement("input",{className:"radio m-1",type:"radio",name:"DieType",value:100,id:"d-100",onChange:function(t){return e.setState({diceType:t.target.value})}}),"D-100"))),r.a.createElement("li",{className:"nav-item"},r.a.createElement("label",{className:"mr-1 col-md-5 p-0"},"How many dice? "),r.a.createElement("input",{className:"input-group-sm mb-3 form-control col-md-5 d-inline mt-2",id:"diceCount",type:"number",step:1,min:1,max:200,value:a,onChange:function(t){return e.setState({diceCount:t.target.value.replace(/\D/,"")})}})),r.a.createElement("li",{className:"nav-item"},r.a.createElement("button",{onClick:this.handleRoll,className:"btn btn-primary form-control mt-1 col-md-3"},"Roll"),r.a.createElement("label",{className:"mr-3 mb-2 radio control-label col-md-8"},"Roll Result Sum:"," ",r.a.createElement("span",{className:"rollResult",hidden:!n},n))))}}]),a}(n.Component)),p=a(110),g=(a(128),a(129),function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"getCellStyle",value:function(){var e=this.props,t=e.borderWidth,a=e.cell,n=e.cursorHover,r=e.cellSize,l="solid black ",o="rgba(0, 0, 0, ";return{width:r,height:r,border:l+=t+"px",background:o+=a.wall?"0.4)":"0)",cursor:n}}},{key:"render",value:function(){this.props.selected;var e=this.props,t=e.onClick,a=e.cell,n=e.onMouseEnterCell;return r.a.createElement("div",{className:"CellStyle",style:this.getCellStyle(),onClick:function(){return t(a)},onMouseEnter:function(){return n(a)}})}}]),a}(n.Component)),C="/dnd-online-board/images/",b=C+"characters/",f={ranger:b+"ranger.png",rogue:b+"rogue.png",sorcerer:b+"sorcerer.png",warlock:b+"warlock.png",fighter:b+"fighter.png",scorbat:b+"scorbat.png",dragon:b+"dragon.png",beetle:b+"beetle.png",balrog:b+"balrog.png",alligator:b+"alligator.png"},v="/dnd-online-board/images/cursors/move.png",E="/dnd-online-board/images/cursors/pointer.png",w="/dnd-online-board/images/cursors/delete.png",k=function(e){var t=e.componentStack,a=e.error;return r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement("strong",null,"Oops! An error occured! I guess I haven't done enough QA because I really wanted to show you the project early! But hey, at least I caught the error using a boundary :)")),r.a.createElement("p",null,"Here\u2019s what I know about the error:"),r.a.createElement("p",null,r.a.createElement("strong",null,"Error:")," ",a.toString()),r.a.createElement("p",null,r.a.createElement("strong",null,"Stacktrace:")," ",t))},N=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"getStyle",value:function(){var e=this.props,t=e.selected,a=e.position,n=e.borderWidth,r=e.transparent,l=e.itemDeletionModeOn,o=e.clickable,s=t||l?"solid red":"none";s+=" "+n+"px";var c=r?.45:1;return{width:a.width,height:a.height,position:"absolute",top:a.topLeft.row,left:a.topLeft.col,border:s,cursor:l?"url("+w+"), pointer":o?"url("+E+"), pointer":"url("+v+"), move",opacity:c,pointerEvents:o?"auto":"none"}}},{key:"render",value:function(){var e=this.props,t=e.character,a=e.onClick;if(!t)return"";var n=this.props.character.image,l=n.url?n.url:n.file;return r.a.createElement("img",{src:l,alt:t.name,style:this.getStyle(),onClick:function(){return a(t)},title:t.name})}}]),a}(n.Component),y=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"getStyle",value:function(){var e=this.props,t=e.position,a=e.itemDeletionModeOn,n=e.borderWidth,r=e.clickable,l=e.selected,o=this.props.spellCircle.color,s="rgb("+o.r+", "+o.g+", "+o.b+", 0.5) ",c=null;return(a||l)&&(c="solid rgb(255, 0, 0, 1) "+(n+1)+"px"),{position:"absolute",top:t.row,left:t.col,height:2*t.radius,width:2*t.radius,background:s,borderRadius:t.radius,cursor:a?"url("+w+"), pointer":r?"url("+E+"), pointer":"url("+v+"), move",border:c,pointerEvents:r?"auto":"none"}}},{key:"render",value:function(){var e=this.props,t=e.spellCircle,a=e.onClick;return t?r.a.createElement("div",{style:this.getStyle(),onClick:function(){return a(t)},title:t.name+(t.owner?". Owner: "+t.owner:null)}):""}}]),a}(n.Component),S=(a(130),function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"getBackgroundClass",value:function(){return this.props.itemDeletionModeOn?"DeletionMode":""}},{key:"render",value:function(){var e=this.props,t=e.matrix,a=e.selectedChar,n=e.characters,l=e.selectedCircle,o=e.spellCircles,s=e.cellSize,c=e.borderWidth,i=e.onCellClick,m=e.onCharClick,u=e.onCalcCharPosition,h=e.onMouseEnterCell,d=e.placingChar,p=e.itemDeletionModeOn,C=e.onSpellCircleClick,b=e.onCalcSpellCirclePosition,f=e.placingCircle;return r.a.createElement("div",null,r.a.createElement("div",null,t.map((function(e,t){return r.a.createElement("div",{key:t},e.map((function(e,t){return r.a.createElement(g,{key:t,cell:e,cellSize:s,onClick:i,borderWidth:c,cursorHover:f||d?"url("+E+"), pointer":"url("+v+"), move",onMouseEnterCell:h})})))}))),r.a.createElement("div",{className:this.getBackgroundClass()},o.map((function(e,t){return r.a.createElement(y,{key:t,spellCircle:e,borderWidth:c,position:b(e),onClick:C,itemDeletionModeOn:p,placingCircle:f,clickable:!d&&!f&&!p||p,selected:l===e})})),f?r.a.createElement(y,{spellCircle:f,borderWidth:c,position:b(f),onClick:C,itemDeletionModeOn:p,placingCircle:f,clickable:!1,selected:!1}):null,n.map((function(e,t){return r.a.createElement(N,{key:t,character:e,selected:a===e,position:u(e),onClick:m,borderWidth:c,transparent:d===e,itemDeletionModeOn:p,clickable:!d&&!f&&!p||p})})),d?r.a.createElement(N,{character:d,selected:!1,position:u(d),onClick:m,borderWidth:c,transparent:!0,itemDeletionModeOn:p,clickable:!1}):null))}}]),a}(n.Component)),O=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={},n.state={scale:2,translation:{x:0,y:0}},n}return Object(m.a)(a,[{key:"getStyle",value:function(){var e=this.props.mapImage,t=e.url?"url("+e.url+")":e.file;return{mapBgImg:{height:this.props.cellSize*this.props.rowCount,width:this.props.cellSize*this.props.colCount,backgroundImage:t}}}},{key:"render",value:function(){var e=this,t=this.props,a=t.rowCount,n=t.colCount,l=t.matrix,o=t.cellSize,s=t.borderWidth,c=t.selectedChar,i=t.characters,m=t.onCellClick,u=t.onCharClick,h=t.onCalcCharPosition,d=t.onMouseEnterCell,g=t.placingChar,C=t.itemDeletionModeOn,b=t.spellCircles,f=t.onSpellCircleClick,v=t.onCalcSpellCirclePosition,E=t.placingCircle,w=t.selectedCircle,k=this.state,N=k.scale,y=k.translation;return r.a.createElement(p.MapInteractionCSS,{scale:N,translation:y,onChange:function(t){var a=t.scale,n=t.translation;return e.setState({scale:a,translation:n})}},r.a.createElement("div",{className:"MapBgImg",style:this.getStyle().mapBgImg},r.a.createElement(S,{rowCount:a,colCount:n,matrix:l,cellSize:o,borderWidth:s,selectedChar:c,characters:i,selectedCircle:w,spellCircles:b,onCellClick:m,onCharClick:u,onCalcCharPosition:h,onMouseEnterCell:d,placingChar:g,itemDeletionModeOn:C,onSpellCircleClick:f,onCalcSpellCirclePosition:v,placingCircle:E})))}}]),a}(n.Component),M=a(34),P=a(111),j=a.n(P),T=(a(131),Object.values(f)),D=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).state={characterName:"",height:1,width:1,avatarImage:null,missingFields:!1},e.onPickAvatar=function(t){e.setState({avatarImage:t})},e.handleCancelCreation=function(){e.initiateState(),e.props.onCancel()},e.handleCreateButtonClick=function(){var t=Object(c.a)({},e.state),a=t.characterName,n=t.height,r=t.width,l=Object(c.a)({},e.state).avatarImage;!a||n<=0||r<=0||!l?e.setState({missingFields:!0}):(e.setState({missingFields:!1}),e.initiateState(),l=l.src,e.props.onCreation({characterName:a,height:n,width:r,avatarImage:l}))},e}return Object(m.a)(a,[{key:"initiateState",value:function(){this.setState({characterName:"",height:1,width:1,avatarImage:null,missingFields:!1})}},{key:"onChangeSize",value:function(e,t){var a=Number(e.target.value.replace(/\D/,""));(e.target.min>a||a>e.target.max)&&(a=t?this.state.height:this.state.width),t?this.setState({height:a}):this.setState({width:a})}},{key:"getFileName",value:function(e){return e.replace(/^.*[\\\/]/,"")}},{key:"render",value:function(){var e=this,t=this.state,a=t.characterName,n=t.height,l=t.width;t.avatarFile;return r.a.createElement("ul",{className:"nav nav-tabs flex-column bg-dark row w-100 p-20 MenuUl"},r.a.createElement("div",null,r.a.createElement("h4",{className:"mb-4"},r.a.createElement("span",{className:"creatorHeader ml-2"},"Add a New Character"))),r.a.createElement("li",{className:"nav-item"},r.a.createElement("div",{className:"col"},r.a.createElement("input",{className:"input-group-sm form-control",id:"characterName",value:a,placeholder:"Character name",required:!0,onChange:function(t){return e.setState({characterName:t.target.value})}}))),r.a.createElement("li",{className:"nav-item col"},r.a.createElement("div",{className:"row mt-3 mb-3"},r.a.createElement("span",Object(M.a)({className:"form-group"},"className","col-6 d-inline"),r.a.createElement("label",{className:"d-inline col-5",htmlFor:"width"},"Width in squares:"),r.a.createElement("input",{className:"input-group-sm form-control d-inline col-7",id:"width",type:"number",step:1,min:1,max:6,value:l,required:!0,onChange:function(t){return e.onChangeSize(t,!1)}})),r.a.createElement("span",Object(M.a)({className:"form-group"},"className","col-6 d-inline"),r.a.createElement("label",{className:"d-inline col-5",htmlFor:"height"},"Height in squares:"),r.a.createElement("input",{className:"input-group-sm form-control d-inline col-7",id:"height",type:"number",step:1,min:1,max:6,value:n,required:!0,onChange:function(t){return e.onChangeSize(t,!0)}})))),r.a.createElement("li",{className:"nav-item col"},r.a.createElement("span",{className:"form-group"},r.a.createElement("label",{className:"mr-3 mb-3"},"Choose Avatar:"),r.a.createElement("span",null,r.a.createElement(j.a,{images:T.map((function(e,t){return{src:e,value:t}})),onPick:this.onPickAvatar})))),r.a.createElement("li",{className:"nav-item"},r.a.createElement("span",{className:"row mt-3"},r.a.createElement("div",{className:"mt-3 col-8 d-inline"},r.a.createElement("button",{onClick:this.handleCreateButtonClick,className:"btn btn-primary form-control"},"Create!")),r.a.createElement("div",{className:"mt-3 col-4 d-inline"},r.a.createElement("button",{onClick:this.handleCancelCreation,className:"btn btn-danger form-control"},"Cancel")))),this.state.missingFields?r.a.createElement("li",{className:"nav-item col"},r.a.createElement("h4",null,r.a.createElement("span",{className:"badge badge-danger"},"Not all fields are filled/selected!"))):null)}}]),a}(n.Component),x=(a(29),function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).handleCharacterCreationClick=function(t){e.props.closePopup(),e.props.onCharacterCreation(t)},e.handleCancelCreation=function(){e.props.closePopup()},e}return Object(m.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"PopUp"},r.a.createElement("div",{className:"CharacterCreatorPopUpInner"},r.a.createElement(D,{onCreation:this.handleCharacterCreationClick,onCancel:this.handleCancelCreation})))}}]),a}(n.Component)),L=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.onCharacterCreation,a=e.onSpellCircleCreation,l=e.onCharacterCircleDelete,o=e.onShowPlayersLink,s=e.enableDeletion,c=e.itemDeletionModeOn,i=e.onFinishDeletion,m=e.onExitToMenu,u=e.gameMaster;return r.a.createElement("ul",{className:"nav nav-tabs flex-column bg-dark row w-100 MenuUl ml-1"},r.a.createElement("h4",{className:"mb-3"},r.a.createElement("span",{className:"creatorHeader"},"Actions")),c?r.a.createElement("li",{className:"nav-item"},r.a.createElement("h5",{className:"mt-3"},"Click items on the map to delete them"),r.a.createElement("button",{onClick:i,className:"btn btn-danger form-control mt-1"},"Finish Deletion")):r.a.createElement("span",null,r.a.createElement("li",{className:"nav-item"},r.a.createElement("button",{onClick:t,className:"btn btn-primary form-control mt-3"},"Create a New Character")),r.a.createElement("li",{className:"nav-item"},r.a.createElement("button",{onClick:a,className:"btn btn-primary form-control mt-3"},"Create a Spell Circle")),r.a.createElement("li",{className:"nav-item"},r.a.createElement("button",{onClick:l,className:"btn btn-primary form-control mt-3",disabled:!s},"Delete a Character / Circle")),u?r.a.createElement(n.Fragment,null,r.a.createElement("li",{className:"nav-item"},r.a.createElement("button",{onClick:o,className:"btn btn-primary form-control mt-3"},"Show Link for Players")),r.a.createElement("li",{className:"nav-item"},r.a.createElement("button",{onClick:m,className:"btn btn-primary form-control mt-3"},"Exit to Menu"))):null))}}]),a}(n.Component),G=a(68),U=a.n(G),F=a(21),R=a.n(F),I=a(69),W=a.n(I),A=a(112),B=function(e){return J("/auth/login/","POST",e)},H=function(e){return J("/auth/register/","POST",e)},z=function(e){return J("/gameData","GET",void 0,e)},q=function(e,t){return J("/gameData","POST",e,t)},V=function(e,t){return J("/gameData","PATCH",e,t)},_="https://dnd-online-board.herokuapp.com",Y=function(e,t){return{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}},J=function(){var e=Object(A.a)(W.a.mark((function e(t,a){var n,r,l,o,s,c,i=arguments;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:void 0,r=i.length>3&&void 0!==i[3]?i[3]:null,l=_+t,o=Y(a,n),r&&(o.headers["auth-token"]=r),console.debug("sending: ",o,l),e.prev=6,e.next=9,fetch(l,o);case 9:return s=e.sent,console.debug("result:",s),e.next=13,s.json();case 13:return c=e.sent,console.debug("response: ",{status:s.status,body:c}),e.abrupt("return",{status:s.status,body:c});case 18:e.prev=18,e.t0=e.catch(6),console.error("Error with request "+a+" to url "+l,"body:",n,e.t0.message,e.t0.stack?e.t0.stack:null);case 21:case"end":return e.stop()}}),e,null,[[6,18]])})));return function(t,a){return e.apply(this,arguments)}}(),K=a(113),Q=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).state={spellName:"",ownerName:"",radius:5,color:{r:"241",g:"112",b:"19",a:"1"},missingFields:!1,isRadiusValid:!0},e.handleCancelCreation=function(){e.initiateState(),e.props.onCancel()},e.handleCreateButtonClick=function(){var t=Object(c.a)({},e.state),a=t.spellName,n=t.ownerName,r=t.radius,l=t.color;e.setState({isRadiusValid:!0,missingFields:!1}),a&&l?5>r||r>60?e.setState({isRadiusValid:!1}):(e.initiateState(),e.props.onCreation({spellName:a,ownerName:n,radius:r,color:l})):e.setState({missingFields:!0})},e}return Object(m.a)(a,[{key:"initiateState",value:function(){this.setState({spellName:"",ownerName:"",radius:5,color:{r:"241",g:"112",b:"19",a:"1"},missingFields:!1,isRadiusValid:!0})}},{key:"onChangeRadius",value:function(e){var t=Number(e.target.value.replace(/\D/,""));this.setState({radius:t})}},{key:"render",value:function(){var e=this,t=this.state,a=t.spellName,n=t.ownerName,l=t.radius,o=t.color,s=t.isRadiusValid,c=t.missingFields;return r.a.createElement("ul",{className:"nav nav-tabs flex-column bg-dark row w-100 MenuUl p-20"},r.a.createElement("h4",{className:"col mb-5"},r.a.createElement("span",{className:"creatorHeader"},"Add a Spell Circle")),r.a.createElement("span",{className:"row"},r.a.createElement("span",{className:"col-8 d-inline"},r.a.createElement("li",{className:"nav-item"},r.a.createElement("input",{className:"input-group-sm form-control col",id:"spellName",value:a,placeholder:"Spell name",required:!0,onChange:function(t){return e.setState({spellName:t.target.value})}})),r.a.createElement("li",{className:"nav-item"},r.a.createElement("input",{className:"input-group-sm form-control col mt-3",id:"ownerName",value:n,placeholder:"Owner name (optional)",onChange:function(t){return e.setState({ownerName:t.target.value})}})),r.a.createElement("li",{className:"nav-item"},r.a.createElement("label",{className:"col align-text-bottom mt-3"},"Radius in feet (a square is 5 feet wide):"),r.a.createElement("input",{className:"input-group-sm form-control col",id:"radius",type:"number",step:5,min:5,max:60,value:l,required:!0,onChange:function(t){return e.onChangeRadius(t,!1)}}))),r.a.createElement("li",{className:"nav-item col-3 d-inline"},r.a.createElement("label",{className:"mb-2"},"Choose color for the circle:"),r.a.createElement(K.SketchPicker,{color:o,onChange:function(t){return e.setState({color:t.rgb})}}))),r.a.createElement("li",{className:"nav-item"},r.a.createElement("span",{className:"row mt-3"},r.a.createElement("div",{className:"mt-3 col-8 d-inline"},r.a.createElement("button",{onClick:this.handleCreateButtonClick,className:"btn btn-primary form-control"},"Create!")),r.a.createElement("div",{className:"mt-3 col-4 d-inline"},r.a.createElement("button",{onClick:this.handleCancelCreation,className:"btn btn-danger form-control"},"Cancel")))),c?r.a.createElement("li",{className:"nav-item col"},r.a.createElement("h4",null,r.a.createElement("span",{className:"badge badge-danger"},"Not all fields are filled/selected!"))):null,s?null:r.a.createElement("li",{className:"nav-item col"},r.a.createElement("h4",null,r.a.createElement("span",{className:"badge badge-danger"},"Radius value should be ",5,"-",60))))}}]),a}(n.Component),$=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).handleSpellCircleCreationClick=function(t){e.props.closePopup(),e.props.onSpellCircleCreation(t)},e.handleCancelCreation=function(){e.props.closePopup()},e}return Object(m.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"PopUp"},r.a.createElement("div",{className:"SpellCircleCreatorPopUpInner"},r.a.createElement(Q,{onCreation:this.handleSpellCircleCreationClick,onCancel:this.handleCancelCreation})))}}]),a}(n.Component),X=(a(47),a(24)),Z=a(11),ee=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).state={email:"",password:"",errorMessage:"",toGameMenu:!1},e.handleLoginFormSubmit=function(t){t.preventDefault();var a=e.state,n=a.email,r=a.password,l=e.props.onLogin;B({email:n,password:r}).then((function(t){t&&(200!==t.status?e.setState({errorMessage:t.body.error.message}):(e.setState({toGameMenu:!0}),l(t.body.userName,t.body.authToken)))}))},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.email,n=t.password,l=t.errorMessage;return t.toGameMenu?r.a.createElement(X.a,{to:"/home/game_menu"}):r.a.createElement("div",{className:"HomeBgContent"},r.a.createElement("form",{onSubmit:this.handleLoginFormSubmit},r.a.createElement("ul",{className:"MenuUl bg-dark w-100"},r.a.createElement("h4",{className:"mb-4"},r.a.createElement("span",{className:"creatorHeader"},"Welcome to D&D Online Board")),r.a.createElement("li",{className:"mb-3"},r.a.createElement(Z.b,{to:"/home/about"},r.a.createElement("h5",null,"What is D&D Online Board?"))),r.a.createElement("li",null,r.a.createElement("input",{className:"input-group-sm form-control",id:"email",value:a,placeholder:"Email Address",required:!0,onChange:function(t){return e.setState({email:t.target.value})}})),r.a.createElement("li",null,r.a.createElement("input",{className:"input-group-sm form-control mt-3",type:"password",id:"password",value:n,placeholder:"Password",required:!0,onChange:function(t){return e.setState({password:t.target.value})}})),r.a.createElement("li",null,r.a.createElement("button",{type:"submit",className:"btn btn-primary form-control mt-3"},"Log In")),r.a.createElement("li",{className:"mt-2"},r.a.createElement(Z.b,{to:"/home/register"},"New user?"),r.a.createElement(Z.b,{className:"float-right",to:"/home/forgot_password"},"Forgot password?")),l?r.a.createElement("li",null,r.a.createElement("h4",null,r.a.createElement("span",{className:"badge badge-danger"},l))):null)))}}]),a}(n.Component),te=!1,ae=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).state={toLogin:!1,toMap:!1,gameDataExists:!1,continueGameText:""},e.handleLogOutClick=function(){e.setState({toLogin:!0}),e.props.onLogOut()},e.handleStartNewGameButtonClick=function(){e.state.gameDataExists?e.setState({showWarning:!0}):e.beginNewGame()},e.beginNewGame=function(){e.setState({toMap:!0}),e.props.onStartANewGame()},e.handleContinueGameClick=function(){e.setState({toMap:!0}),e.props.onContinueSavedGame()},e}return Object(m.a)(a,[{key:"componentWillMount",value:function(){this.props.cancelRedirectFromMap()}},{key:"componentDidMount",value:function(){te=!0,this.state&&this.props.authToken&&this.checkForExistingGameData(this.props.authToken)}},{key:"componentWillUnmount",value:function(){te=!1}},{key:"componentWillReceiveProps",value:function(e){te&&this.props.authToken!==e.authToken&&this.checkForExistingGameData(e.authToken)}},{key:"checkForExistingGameData",value:function(e){var t=this;this.setState({continueGameText:"Collecting game data from server..."}),z(e).then((function(e){e&&te&&(200!==e.status?t.setState({continueGameText:"No Saved Game"}):t.setState({gameDataExists:!0,continueGameText:"Continue Last Saved Game"}))}))}},{key:"renderGameMenu",value:function(){var e=this,t=this.props.userName,a=this.state,l=a.showWarning,o=a.gameDataExists,s=a.continueGameText;return r.a.createElement(n.Fragment,null,r.a.createElement("h4",{className:"mb-4"},r.a.createElement("span",{className:"creatorHeader"},"Hi, ",t,"! Ready to play?")),r.a.createElement("li",null,r.a.createElement("button",{onClick:this.handleContinueGameClick,className:"btn btn-primary form-control mt-3",disabled:!o},s)),r.a.createElement("li",null,r.a.createElement("button",{onClick:this.handleStartNewGameButtonClick,className:"btn btn-primary form-control mt-3"},"Start a New Game")),r.a.createElement("li",{className:"mt-2 mb-3"},r.a.createElement("a",{className:"float-right",href:"#",onClick:this.handleLogOutClick},"Log Out")),l?r.a.createElement("span",null,r.a.createElement("li",{className:"mt-2"},r.a.createElement("h6",null,"Starting a new game will erase the last saved game, continue?")),r.a.createElement("span",{className:"inline-form row"},r.a.createElement("button",{onClick:this.beginNewGame,className:"btn btn-danger form-control ml-3 mt-3 col-7 d-inline"},"Yes - Delete my saved game"),r.a.createElement("button",{onClick:function(){return e.setState({showWarning:!1})},className:"btn btn-primary form-control ml-2 mt-3 col-4 d-inline"},"No - Keep my saved game"))):null)}},{key:"renderNotLoggedInError",value:function(){return r.a.createElement(n.Fragment,null,r.a.createElement("h4",{className:"mb-4"},r.a.createElement("span",{className:"creatorHeader"},"Hey... unknown user!"),r.a.createElement("br",null),r.a.createElement("br",null),"Oops! You can't see the game menu if you're not logged in :) ",r.a.createElement("br",null),"Please log in to play."),r.a.createElement(Z.b,{to:"/home/login"},"Login Here"))}},{key:"render",value:function(){var e=this.props.authToken,t=this.state,a=t.toLogin,n=t.toMap;return a?r.a.createElement(X.a,{push:!0,to:"/home/login"}):n?r.a.createElement(X.a,{push:!0,to:"/map"}):r.a.createElement("div",{className:"GameMenuBgContent"},r.a.createElement("ul",{className:"MenuUl bg-dark w-100"},e?this.renderGameMenu():this.renderNotLoggedInError()))}}]),a}(n.Component),ne=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).state={email:"",errMessage:"",messageUnderBox:"A message with a link to reset your password will be sent to this email address."},e.handleSendButtonClick=function(){var t=e.state.email;e.setState({messageUnderBox:"Please wait..."}),e.callResetPasswordSendAPI(t)},e}return Object(m.a)(a,[{key:"callResetPasswordSendAPI",value:function(e){var t=this;J("/auth/reset_password/send","POST",{email:e}).then((function(e){e&&(200!==e.status?t.setState({errMessage:e.body.error.message,messageUnderBox:"An error has occured"}):t.setState({emailSent:!0,messageUnderBox:"Reset message sent to email address!"}))}))}},{key:"render",value:function(){var e=this,t=this.state,a=t.email,n=t.errMessage,l=t.messageUnderBox;return r.a.createElement("div",{className:"HomeBgContent"},r.a.createElement("ul",{className:"MenuUl bg-dark w-100"},r.a.createElement("h4",{className:"mb-5"},r.a.createElement("span",{className:"creatorHeader"},"Reset Password")),r.a.createElement("li",null,r.a.createElement("input",{className:"input-group-sm form-control",id:"email",value:a,placeholder:"Email Address",required:!0,onChange:function(t){return e.setState({email:t.target.value})}})),r.a.createElement("li",null,r.a.createElement("label",null,l)),r.a.createElement("li",null,r.a.createElement("button",{onClick:this.handleSendButtonClick,className:"btn btn-primary form-control mt-3"},"Send")),r.a.createElement("li",{className:"mt-2 mb-4"},r.a.createElement(Z.b,{className:"float-right",to:"/home/login"},"Back to log in")),n?r.a.createElement("li",null,r.a.createElement("h4",null,r.a.createElement("span",{className:"badge badge-danger"},n))):null))}}]),a}(n.Component),re=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).state={userName:"",email:"",password:"",errorMessage:"",toLogin:!1},e.handleRegisterFormSubmit=function(t){t.preventDefault();var a=e.state,n=a.userName,r=a.email,l=a.password,o=e.props.onRegistered;H({userName:n,email:r,password:l}).then((function(t){t&&(200!==t.status?e.setState({errorMessage:t.body.error.message}):(e.setState({toLogin:!0}),o()))}))},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.userName,n=t.email,l=t.password,o=t.errorMessage;return t.toLogin?r.a.createElement(X.a,{push:!0,to:"/home/login"}):r.a.createElement("div",{className:"HomeBgContent"},r.a.createElement("form",{onSubmit:this.handleRegisterFormSubmit},r.a.createElement("ul",{className:"MenuUl bg-dark w-100"},r.a.createElement("h4",{className:"mb-5"},r.a.createElement("span",{className:"creatorHeader"},"New User Registration")),r.a.createElement("li",null,r.a.createElement("input",{className:"input-group-sm form-control",id:"userName",value:a,placeholder:"User Name",required:!0,onChange:function(t){return e.setState({userName:t.target.value})}})),r.a.createElement("li",null,r.a.createElement("input",{className:"input-group-sm form-control mt-3",id:"email",value:n,placeholder:"Email Address",required:!0,onChange:function(t){return e.setState({email:t.target.value})}})),r.a.createElement("li",null,r.a.createElement("input",{className:"input-group-sm form-control mt-3",type:"password",id:"password",value:l,placeholder:"Password",required:!0,onChange:function(t){return e.setState({password:t.target.value})}})),r.a.createElement("li",null,r.a.createElement("button",{type:"submit",className:"btn btn-primary form-control mt-3"},"Register")),r.a.createElement("li",{className:"mt-2 mb-4"},r.a.createElement(Z.b,{className:"float-right",to:"/home/login"},"Already registered? log in")),o?r.a.createElement("li",null,r.a.createElement("h4",null,r.a.createElement("span",{className:"badge badge-danger"},o))):null)))}}]),a}(n.Component),le=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"AboutScreenContent"},r.a.createElement("ul",{className:"MenuUl bg-dark w-100"},r.a.createElement("h4",{className:"mb-5"},r.a.createElement("span",{className:"creatorHeader"},"What is D&D Online Board?")),r.a.createElement("p",null,r.a.createElement("h4",null,"What is D&D?"),r.a.createElement("label",null,"D&D stands for Dungeons & Dragons. It's a fantasy tabletop role-playing game (RPG) in which every participant plays a character. Characters can do anything a real life person can do and more - they can talk, walk, jump, fight each other or fight monsters, etc. It's all done by explicitly saying what the character does. One of the participants plays a \"game master\" and decides, according to traditional methods, which actions succeed and which fail.")),r.a.createElement("p",null,r.a.createElement("h4",null,"What is a D&D Board?"),r.a.createElement("label",null,"When a fight happens, there's a strict system that determines which character goes first, how far it can walk in one turn, and if the actions succeed. This is done with the help of a map board in which every square is 5 feet long, and different types of dice to determine which attacks succeed and how much damage is done. Usually the map is a physical board with character miniatures as pawns, and the participants meet together to play.")),r.a.createElement("div",{className:"row"},r.a.createElement("p",{className:"col-6"},r.a.createElement("h4",null,"What can I do in D&D Online Board?"),r.a.createElement("label",null,"Instead of driving and physically meeting, you can play online with your friends. Just connect to an online conversation app, and use our online board site to view the same world and take character actions."),r.a.createElement("ul",{className:"pl-3 mt-2"},r.a.createElement("h5",{className:"font-weight-bold"},"The game includes:"),r.a.createElement("li",null,"Simultaneous gameplay for multiple players/computers."),r.a.createElement("li",null,"Chacacters and monsters that can be placed and move on the board."),r.a.createElement("li",null,"Spell effect circular areas that can be placed and move on the board."),r.a.createElement("li",null,"All dice types virtual roll available on the side-bar during the game."),r.a.createElement("li",null,"Your progress is automatically saved, you can continue to play another time."),r.a.createElement("br",null),r.a.createElement(Z.b,{to:"/home/register"},r.a.createElement("h4",null,"This sounds so cool! I want to play!")))),r.a.createElement("div",{className:"col-6"},r.a.createElement("img",{src:"/dnd-online-board/images/misc/gameplay.png",alt:"gameplay",style:{width:"100%",height:"auto"}})))))}}]),a}(n.Component),oe=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.onNewGame,a=e.onContinueSavedGame,n=e.authToken,l=e.userName,o=e.onRegisteredNewUser,s=e.onLogOut,c=e.cancelRedirectFromMap,i=e.onLogIn;return r.a.createElement("div",{className:"HomeBg"},r.a.createElement(X.d,null,r.a.createElement(X.a,{exact:!0,from:"/home",to:n?"/home/game_menu":"/home/login"}),r.a.createElement(X.b,{path:"/home/game_menu"},r.a.createElement(ae,{onContinueSavedGame:a,onStartANewGame:t,onLogOut:s,userName:l,authToken:n,cancelRedirectFromMap:c})),r.a.createElement(X.b,{path:"/home/forgot_password"},r.a.createElement(ne,null)),r.a.createElement(X.b,{path:"/home/about"},r.a.createElement(le,null)),r.a.createElement(X.b,{path:"/home/register"},r.a.createElement(re,{onRegistered:o})),r.a.createElement(X.b,{path:"/home/login"},r.a.createElement(ee,{onLogin:i}))))}}]),a}(n.Component),se=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"PopUp"},r.a.createElement("div",{className:"TempMessageInner"},r.a.createElement("div",{className:"text-white",style:{textAlignLast:"center"}},r.a.createElement("h2",null,this.props.message))))}}]),a}(n.Component),ce=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={newPassword:"",confirmPassword:"",errorMessage:"",authToken:null,tokenValid:!1,isLoading:!0,toLogin:!1},n.handleChangePasswordFormSubmit=function(e){e.preventDefault();var t=n.state,a=t.newPassword,r=t.confirmPassword,l=t.authToken,o=n.props.onPasswordReset;a&&r?a===r?J("/auth/reset_password/reset","POST",{newPassword:a,authToken:l}).then((function(e){e&&(200!==e.status?n.setState({errorMessage:e.body.error.message}):(n.setState({toLogin:!0}),o()))})):n.setState({errorMessage:"Passwords must match"}):n.setState({errorMessage:"Please fill both of the above fields"})},n.state.authToken=n.getAuthTokenFromParams(),n}return Object(m.a)(a,[{key:"componentDidMount",value:function(){this.state.authToken&&this.isTokenMatchesUSer()}},{key:"getAuthTokenFromParams",value:function(){var e=window.location.href.split("/");return e[e.length-1]}},{key:"isTokenMatchesUSer",value:function(){var e,t=this;(e=this.state.authToken,J("/auth/user/"+e,"GET")).then((function(e){e&&(200!==e.status?t.setState({errorMessage:e.body.error.message,isLoading:!1}):t.setState({tokenValid:!0,isLoading:!1}))}))}},{key:"renderLoadingPage",value:function(){return r.a.createElement("ul",{className:"MenuUl bg-dark w-100 h-100 row"},r.a.createElement("h4",{className:"mb-5"},r.a.createElement("span",{className:"creatorHeader"},"Page loading...")))}},{key:"renderAccessDeniedPage",value:function(){return r.a.createElement("ul",{className:"MenuUl bg-dark w-100 h-100 row"},r.a.createElement("li",{className:"md-5"},r.a.createElement("h3",{className:"mb-5"},r.a.createElement("span",{className:"creatorHeader"},"Access denied")),r.a.createElement("h5",null,"If you're trying to reset your password, this link may be an old password reset link.",r.a.createElement("br",null)," Please look for the latest one in your inbox/spam folder or request a new one.")))}},{key:"renderPasswordResetPage",value:function(){var e=this,t=this.state,a=t.newPassword,n=t.confirmPassword,l=t.errorMessage;return t.toLogin?r.a.createElement(X.a,{push:!0,to:"/home/login"}):r.a.createElement("div",{className:"HomeBg"},r.a.createElement("div",{className:"HomeBgContent"},r.a.createElement("form",{onSubmit:this.handleChangePasswordFormSubmit},r.a.createElement("ul",{className:"MenuUl bg-dark w-100"},r.a.createElement("h4",{className:"mb-5"},r.a.createElement("span",{className:"creatorHeader"},"D&D Online Board")),r.a.createElement("h4",null,"Reset Password"),r.a.createElement("li",null,r.a.createElement("input",{className:"input-group-sm form-control mt-3",type:"password",id:"newPassword",value:a,placeholder:"New Password",required:!0,onChange:function(t){return e.setState({newPassword:t.target.value})}})),r.a.createElement("li",null,r.a.createElement("input",{className:"input-group-sm form-control mt-3",type:"password",id:"confirmPassword",value:n,placeholder:"Confirm Password",required:!0,onChange:function(t){return e.setState({confirmPassword:t.target.value})}})),r.a.createElement("li",null,r.a.createElement("button",{type:"submit",className:"btn btn-primary form-control mt-3"},"Submit")),l?r.a.createElement("li",{className:"nav-item col mt-4"},r.a.createElement("h4",null,r.a.createElement("span",{className:"badge badge-danger"},l))):null))))}},{key:"render",value:function(){var e=this.state,t=e.tokenValid;return e.isLoading?this.renderLoadingPage():t?this.renderPasswordResetPage():this.renderAccessDeniedPage()}}]),a}(n.Component),ie=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).handleExitToMenu=function(t){e.props.closePopup(),e.props.onExitToMenu()},e.handleCancelExit=function(){e.props.closePopup()},e}return Object(m.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"PopUp"},r.a.createElement("div",{className:"ExitWarningPopUpInner"},r.a.createElement("div",{className:"nav nav-tabs flex-column text-white bg-dark row w-100",style:{border:"8px double blue",fontSize:15,padding:20}},r.a.createElement("h4",null,"Your progress is saved. Exit to menu?"),r.a.createElement("span",{className:"row mt-3"},r.a.createElement("div",{className:"col-7 d-inline"},r.a.createElement("button",{onClick:this.handleExitToMenu,className:"btn btn-primary form-control"},"Yes - Exit to Menu")),r.a.createElement("div",{className:"col-5 d-inline"},r.a.createElement("button",{onClick:this.handleCancelExit,className:"btn btn-danger form-control"},"No - Back to Game"))))))}}]),a}(n.Component),me=a(116),ue=a(117),he=a.n(ue),de=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).handleCopyToClipboardClick=function(t){he()(e.props.gameLink),e.props.closePopup(),e.props.onCopyToClipboard()},e.handleCloseClick=function(){e.props.closePopup()},e}return Object(m.a)(a,[{key:"copyLinkToClipboard",value:function(){console.log("copyLinkToClipboard called"),this.textArea.select(),document.execCommand("copy")}},{key:"render",value:function(){return r.a.createElement("div",{className:"PopUp"},r.a.createElement("div",{className:"ExitWarningPopUpInner"},r.a.createElement("ul",{className:"nav nav-tabs flex-column bg-dark row w-100 p-20 MenuUl"},r.a.createElement("li",null,r.a.createElement("h4",{className:"mb-3"},"Game link for players:"),r.a.createElement("textarea",{rows:3,disabled:!0,className:"form-control"},this.props.gameLink)),r.a.createElement("li",{className:"row"},r.a.createElement("div",{className:"col-8 d-inline"},r.a.createElement("button",{className:"btn btn-primary form-control mt-3",onClick:this.handleCopyToClipboardClick},"Copy To Clipboard")),r.a.createElement("div",{className:"col-4 d-inline"},r.a.createElement("button",{className:"btn btn-danger form-control mt-3",onClick:this.handleCloseClick},"Close"))))))}}]),a}(n.Component),pe=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={authToken:null,userName:"",rowCount:n.props.rowCount,colCount:n.props.colCount,walls:[],cellSize:n.props.cellSize,borderWidth:Math.ceil(.02*n.props.cellSize),matrix:null,selectedChar:null,placingChar:null,selectedCircle:null,placingCircle:null,itemDeletionModeOn:!1,showTempMessage:!1,tempMessageText:"",mapImage:{url:n.props.bgImageLink,file:null},resetPasswordScreen:!1,spellCircles:[],characters:[],showCharacterCreatorPopup:!1,showSpellCircleCreatorPopup:!1,showExitWarningPopUp:!1,showGameMenu:!0,toGameMenu:!1,updating:!1,showPlayerLinkPopUp:!1,gameMaster:!0},n.handleCellClick=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=Object(c.a)({},n.state),r=a.selectedChar,l=a.selectedCircle;if(l){var o=Object(s.a)(n.state.spellCircles),i=n.moveSpellCircle(e);n.handleSaveGame(),t?(o=n.getSpellCirclesArrWithoutSelection(),n.setState({selectedCircle:null,placingCircle:null,spellCircles:o})):i>-1&&n.setState({selectedCircle:o[i]})}if(r){var m=Object(s.a)(n.state.characters);if(e.wall)return void(t&&(m=n.getCharsArrWithoutSelection(),n.setState({selectedChar:null,placingChar:null,characters:m})));var u=n.moveCharacter(e);n.handleSaveGame(),t?(m=n.getCharsArrWithoutSelection(),n.setState({selectedChar:null,placingChar:null,characters:m})):u>-1&&n.setState({selectedChar:m[u]})}},n.handleKeyUp=function(e){var t=Object(c.a)({},n.state),a=t.selectedChar,r=t.selectedCircle;if(a){var l=n.getCharsArrWithoutSelection();n.setState({selectedChar:null,placingChar:null,characters:l})}else if(r){var o=n.getSpellCirclesArrWithoutSelection();n.setState({selectedCircle:null,placingCircle:null,spellCircles:o})}},n.handleCharClick=function(e){var t=Object(c.a)({},n.state),a=t.selectedChar,r=t.placingChar;t.itemDeletionModeOn?n.deleteCharacter(e):(a=e,r=Object(c.a)({},e),n.setState({selectedChar:a,placingChar:r}))},n.handleSpellCircleClick=function(e){var t=Object(c.a)({},n.state),a=t.selectedCircle,r=t.placingCircle;t.itemDeletionModeOn?n.deleteSpellCircle(e):(a=e,r=Object(c.a)({},e),n.setState({selectedCircle:a,placingCircle:r}))},n.calcCharPosition=function(e){var t=n.props.cellSize,a=n.state.borderWidth,r=null,l=null;return null!==e.topLeftRow&&null!==e.topLeftCol&&(r=e.topLeftRow*t+a,l=e.topLeftCol*t+a),{topLeft:{row:r,col:l},width:e.widthCells*t-2*a,height:e.heightCells*t-2*a}},n.calcSpellCirclePosition=function(e){var t=n.props.cellSize,a=null,r=null;return null!==e.row&&null!==e.col&&(a=e.row*t-(e.radius/5-.5)*t,r=e.col*t-(e.radius/5-.5)*t),{row:a,col:r,radius:e.radius*(t/5)}},n.handleMouseEnterCell=function(e){var t=Object(c.a)({},n.state),a=t.placingChar,r=t.placingCircle;a?(a.topLeftRow=e.row,a.topLeftCol=e.col,n.setState({placingChar:a})):r&&(r.row=e.row,r.col=e.col,n.setState({placingCircle:r}))},n.handleCharacterCreation=function(e){var t=e.characterName,a=e.height,r=e.width,l={name:t,image:{url:e.avatarImage,file:null},topLeftRow:null,topLeftCol:null,heightCells:a,widthCells:r},o=Object(s.a)(n.state.characters);o.push(l),n.setState({characters:o,placingChar:Object(c.a)({},l),selectedChar:l})},n.toggleCharacterCreatorPopup=function(){n.setState({showCharacterCreatorPopup:!n.state.showCharacterCreatorPopup})},n.handleSpellCircleCreation=function(e){var t={name:e.spellName,owner:e.ownerName,radius:e.radius,row:null,col:null,color:e.color},a=Object(s.a)(n.state.spellCircles);a.push(t),n.setState({spellCircles:a,placingCircle:Object(c.a)({},t),selectedCircle:t})},n.toggleItemDeletionMode=function(){var e=n.state,t=e.itemDeletionModeOn;e.selectedChar&&n.setState({selectedChar:null,placingChar:null,characters:n.getCharsArrWithoutSelection()}),n.setState({itemDeletionModeOn:!t})},n.toggleSpellCircleCreatorPopup=function(){n.setState({showSpellCircleCreatorPopup:!n.state.showSpellCircleCreatorPopup})},n.togglePlayersLinkPopUp=function(){n.setState({showPlayerLinkPopUp:!n.state.showPlayerLinkPopUp})},n.toggleExitWarningPopUp=function(){var e=Object(c.a)({},n.state).showExitWarningPopUp;n.setState({showExitWarningPopUp:!e})},n.handleSaveGame=function(){var e=n.state,t=e.authToken,a={rowCount:e.rowCount,colCount:e.colCount,walls:e.walls,cellSize:e.cellSize,spellCircles:e.spellCircles,characters:e.characters,mapImage:e.mapImage};n.createOrUpdateGameState({gameState:a},t)},n.handleRegisteredNewUser=function(){n.showTempMessage("User registered successfully!",1500)},n.handleStartNewGame=function(){n.setState({showGameMenu:!1,toGameMenu:!1}),n.initiateGame()},n.handleContinueSavedGame=function(){n.setState({showGameMenu:!1,toGameMenu:!1}),z(n.state.authToken).then((function(e){e&&(200!==e.status?console.error(e.body.error.message):n.state.selectedChar||n.state.selectedCircle||n.state.updating||n.setStateFromSavedGameData(e.body.gameState))}))},n.handlePasswordResetComplete=function(){n.showTempMessage("Password changed successfully!",2e3)},n.handleExitToMenu=function(){n.setState({toGameMenu:!0})},n.handleLogIn=function(e,t){n.setState({authToken:t,userName:e})},n.cancelRedirectFromMap=function(){n.setState({toGameMenu:!1})},n.state.matrix=n.createMatrix(n.props.rowCount,n.props.colCount),window.location.href.split("/").includes("reset")&&(localStorage.removeItem("dnd-app"),n.state.resetPasswordScreen=!0),n}return Object(m.a)(a,[{key:"initiateGame",value:function(){this.setState({walls:[],spellCircles:[],characters:[]})}},{key:"setStateFromSavedGameData",value:function(e){var t=this.createMatrix(e.rowCount,e.colCount),a=Math.ceil(.02*e.cellSize);this.setState(Object(c.a)({},e,{matrix:t,borderWidth:a}))}},{key:"createMatrix",value:function(e,t){for(var a=[],n=0;n<e;n++){for(var r=[],l=0;l<t;l++){var o={row:n,col:l,wall:this.isCellWall(n,l)};r.push(o)}a.push(r)}return a}},{key:"isCellWall",value:function(e,t){return this.state.walls.filter((function(a){return a.row===e&&a.col===t})).length>0}},{key:"getCharsArrWithoutSelection",value:function(){var e=Object(s.a)(this.state.characters);return null===e[e.length-1].topLeftRow&&e.pop(),e}},{key:"getSpellCirclesArrWithoutSelection",value:function(){var e=Object(s.a)(this.state.spellCircles);return null===e[e.length-1].row&&e.pop(),e}},{key:"deleteCharacter",value:function(e){var t=this,a=Object(s.a)(this.state.characters);a=a.filter((function(t){return t!==e})),this.setState({characters:a},(function(){t.handleSaveGame(),0===a.length&&0===t.state.spellCircles.length&&t.toggleItemDeletionMode()}))}},{key:"deleteSpellCircle",value:function(e){var t=this,a=Object(s.a)(this.state.spellCircles);a=a.filter((function(t){return t!==e})),this.setState({spellCircles:a},(function(){t.handleSaveGame(),0===t.state.characters.length&&0===a.length&&t.toggleItemDeletionMode()}))}},{key:"getSelectedCharCells",value:function(e){var t=[],a=this.state.matrix,n=e.heightCells+e.topLeftRow-1,r=e.widthCells+e.topLeftCol-1;if(!this.checkIndicesValid(e.topLeftRow,e.topLeftCol,n,r))return console.warn("Can't place character outside map boundary!"),[];for(var l=e.topLeftRow;l<n+1;l++)for(var o=e.topLeftCol;o<r+1;o++)t.push(a[l][o]);return t}},{key:"checkIndicesValid",value:function(e,t,a,n){var r=this.props,l=r.rowCount,o=r.colCount;return e>=0&&t>=0&&a<l&&n<o}},{key:"moveCharacter",value:function(e){var t=Object(c.a)({},this.state),a=t.characters,n=t.selectedChar,r=a.indexOf(n),l=e.row,o=e.col;return this.isNewCharPosValid({row:l,col:o})?(a[r]=Object(c.a)({},this.state.selectedChar),a[r].topLeftRow=l,a[r].topLeftCol=o,this.setState({characters:a}),r):-1}},{key:"moveSpellCircle",value:function(e){var t=Object(c.a)({},this.state),a=t.spellCircles,n=t.selectedCircle,r=a.indexOf(n),l=e.row,o=e.col;return a[r]=Object(c.a)({},this.state.selectedCircle),a[r].row=l,a[r].col=o,this.setState({spellCircles:a}),r}},{key:"isNewCharPosValid",value:function(e){var t=U()(this.state.selectedChar);return t.topLeftRow=e.row,t.topLeftCol=e.col,this.getSelectedCharCells(t).length>0}},{key:"componentDidMount",value:function(){var e=this;if(document.addEventListener("keyup",this.handleKeyUp,!1),localStorage.getItem("dnd-app"),!this.state.authToken&&window.location.href.split("/").includes("game")){this.setState({gameMaster:!1});var t=this.getAuthTokenFromParams();t&&this.setState({authToken:t})}setInterval((function(){var t=e.state,a=t.authToken,n=t.selectedChar,r=t.selectedCircle;!a||n||r||e.handleContinueSavedGame()}),1e3)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keyup",this.handleKeyUp,!1)}},{key:"createOrUpdateGameState",value:function(e,t){var a=this;this.setState({updating:!0}),z(t).then((function(n){n&&(200!==n.status?q:V)(e,t).then((function(e){e&&(a.setState({updating:!1}),200!==e.status&&console.error(e.body.error.message))}))}))}},{key:"showTempMessage",value:function(e,t){var a=this;this.setState({tempMessageText:e},(function(){a.setState({showTempMessage:!0},(function(){setTimeout((function(){return a.setState({showTempMessage:!1,tempMessageText:""})}),t)}))}))}},{key:"renderWelcomeScreen",value:function(){var e=this;return r.a.createElement(R.a,{FallbackComponent:k},r.a.createElement(oe,{onNewGame:this.handleStartNewGame,onContinueSavedGame:this.handleContinueSavedGame,onRegisteredNewUser:this.handleRegisteredNewUser,authToken:this.state.authToken,userName:this.state.userName,onLogOut:function(){return e.setState({authToken:null,userName:""})},onLogIn:this.handleLogIn,cancelRedirectFromMap:this.cancelRedirectFromMap}),this.state.showTempMessage?r.a.createElement(se,{message:this.state.tempMessageText}):null)}},{key:"renderPasswordResetScreen",value:function(){return r.a.createElement(R.a,{FallbackComponent:k},r.a.createElement(ce,{onPasswordReset:this.handlePasswordResetComplete}),this.state.showTempMessage?r.a.createElement(se,{message:this.state.tempMessageText}):null)}},{key:"renderSideBar",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.state,a=t.characters,n=t.spellCircles,l=t.itemDeletionModeOn;return r.a.createElement("div",{className:"SideBar col-3 bg-primary"},r.a.createElement(R.a,{FallbackComponent:k},r.a.createElement(L,{onCharacterCreation:this.toggleCharacterCreatorPopup,onSpellCircleCreation:this.toggleSpellCircleCreatorPopup,onCharacterCircleDelete:this.toggleItemDeletionMode,onShowPlayersLink:this.togglePlayersLinkPopUp,enableDeletion:a.length>0||n.length>0,itemDeletionModeOn:l,onFinishDeletion:this.toggleItemDeletionMode,onExitToMenu:this.toggleExitWarningPopUp,gameMaster:e})),r.a.createElement(R.a,{FallbackComponent:k},r.a.createElement(d,null)))}},{key:"getAuthTokenFromParams",value:function(){var e=window.location.href.split("/");return e[e.length-1]}},{key:"renderMapArea",value:function(){var e=this.state,t=e.rowCount,a=e.colCount,n=e.walls,l=e.cellSize,o=e.borderWidth,s=e.selectedChar,c=e.characters,i=e.selectedCircle,m=e.spellCircles,u=e.matrix,h=e.placingChar,d=e.itemDeletionModeOn,p=e.placingCircle,g=e.mapImage;return r.a.createElement("div",{className:"MapArea h-100 p-0 col-9"},r.a.createElement(R.a,{FallbackComponent:k},r.a.createElement(O,{rowCount:t,colCount:a,walls:n,cellSize:l,borderWidth:o,selectedChar:s,characters:c,selectedCircle:i,spellCircles:m,matrix:u,onCellClick:this.handleCellClick,onCharClick:this.handleCharClick,onCalcCharPosition:this.calcCharPosition,onCalcSpellCirclePosition:this.calcSpellCirclePosition,onMouseEnterCell:this.handleMouseEnterCell,placingChar:h,itemDeletionModeOn:d,onSpellCircleClick:this.handleSpellCircleClick,placingCircle:p,mapImage:g})))}},{key:"renderPopUps",value:function(){var e=this,t=this.state,a=t.showTempMessage,l=t.tempMessageText,o=t.showCharacterCreatorPopup,s=t.showSpellCircleCreatorPopup,c=t.showPlayerLinkPopUp,i=t.showExitWarningPopUp,m=t.gameMaster;return r.a.createElement(n.Fragment,null,o?r.a.createElement(R.a,{FallbackComponent:k},r.a.createElement(x,{closePopup:this.toggleCharacterCreatorPopup,onCharacterCreation:this.handleCharacterCreation})):null,s?r.a.createElement(R.a,{FallbackComponent:k},r.a.createElement($,{closePopup:this.toggleSpellCircleCreatorPopup,onSpellCircleCreation:this.handleSpellCircleCreation})):null,c&&m?r.a.createElement(R.a,{FallbackComponent:k},r.a.createElement(de,{closePopup:this.togglePlayersLinkPopUp,onCopyToClipboard:function(){return e.showTempMessage("Link copied to clipboard",1500)},gameLink:"https://wwwsapir.github.io/dnd-online-board/#/game/"+this.state.authToken})):null,i&&m?r.a.createElement(R.a,{FallbackComponent:k},r.a.createElement(ie,{closePopup:this.toggleExitWarningPopUp,onExitToMenu:this.handleExitToMenu})):null,a?r.a.createElement(se,{message:l}):null)}},{key:"renderNotLoggedInError",value:function(){return r.a.createElement("div",{className:"HomeBg"},r.a.createElement("div",{className:"HomeBgContent"},r.a.createElement("ul",{className:"MenuUl bg-dark w-100"},r.a.createElement("h4",{className:"mb-4"},r.a.createElement("span",{className:"creatorHeader"},"Hey... unknown user!"),r.a.createElement("br",null),r.a.createElement("br",null),"Oops! You can't see the game map if you're not logged in :)",r.a.createElement("br",null),"Please log in to play."),r.a.createElement(Z.b,{to:"/home/login"},"Login Here"))))}},{key:"renderMapMainScreen",value:function(){var e=this.state.gameMaster;return this.state.authToken?r.a.createElement("div",{className:"row h-100 w-100 p-0"},this.renderMapArea(),this.renderSideBar(e),this.renderPopUps(e),")"):this.renderNotLoggedInError()}},{key:"render",value:function(){var e=this;return r.a.createElement(n.Fragment,null,r.a.createElement(X.d,null,r.a.createElement(X.a,{exact:!0,from:"/",to:"/home"}),this.state.toGameMenu?r.a.createElement(X.a,{exact:!0,push:!0,from:"/map",to:"/home"}):null,r.a.createElement(X.b,{path:"/reset"},this.renderPasswordResetScreen()),r.a.createElement(X.b,{path:"/map"},this.renderMapMainScreen()),r.a.createElement(X.b,{path:"/home"},this.renderWelcomeScreen()),r.a.createElement(X.b,{path:"/game"},this.renderMapMainScreen())),r.a.createElement(me.a,{name:"dnd-app",data:this.state,debounce:500,onMount:function(t){return e.setState(t)}}))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ge=a(118);o.a.render(r.a.createElement(r.a.StrictMode,null,ge.isMobile?r.a.createElement("div",null,"This app is unavailable on mobile devices. Please use a a desktop to enter :)"):r.a.createElement("div",{className:"container-fluid DNDMapContainer"},r.a.createElement(Z.a,null,r.a.createElement(X.b,{path:"/"},r.a.createElement(pe,{cellSize:45,rowCount:15,colCount:15,bgImageLink:"/dnd-online-board/images/maps/default.jpg"}))))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},35:function(e,t,a){},47:function(e,t,a){}},[[119,1,2]]]);
//# sourceMappingURL=main.0b59b0f6.chunk.js.map